<?xml version="1.0"?>

<robot xmlns:xacro="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface" name="athena">

  <!-- See TODO: add the wiki link here -->
  <!-- These are absoulte distance value, the sign are decided below -->
  <xacro:property name="base_2_HFE_x" value="${190.00 * 0.001}" />
  <xacro:property name="base_2_HFE_y" value="${104.60 * 0.001}" />

  <xacro:property name="HFE_2_KFE_y" value="${37.45 * 0.001}" />
  <xacro:property name="HFE_2_KFE_z" value="${160.00 * 0.001}" />

  <!-- To check this data to get the center of the foot properly -->
  <xacro:property name="KFE_2_FOOT_y" value="${0.5 * 27.00 * 0.001}" />
  <xacro:property name="KFE_2_FOOT_z" value="${160.00 * 0.001}" />
  
  <xacro:property name="KFE_2_contact_y" value="${0 * 0.001}" />
  <xacro:property name="KFE_2_contact_z" value="${(160.00 + 0.5*27) * 0.001}" />

  <!-- Inertia computation -->
  <xacro:property name="upper_leg_length" value="0.16" />
  <xacro:property name="upper_leg_radius" value="0.025" />
  <xacro:property name="upper_leg_mass" value="0.162" />
  <xacro:property name="lower_leg_mass" value="0.021" />

  <!-- This macro has for purpose to define a left leg -->
  <xacro:macro name="leg" params="prefix is_front is_right mesh_ext
                                  color_name color opacity">

    <!-- Joint between the base and the ${prefix} upper leg -->
    <joint name="${prefix}_HFE" type="revolute">
      <parent link="base_link"/>
      <child link="${prefix}_UPPER_LEG"/>
      <limit effort="1000" lower="-10" upper="10" velocity="1000"/>
      <!-- joints rotates around the y-axis -->
      <axis xyz="0 1 0"/>
      <!-- placement of the joint -->
      <xacro:if value="${is_front}">
        <xacro:unless value="${is_right}">
          <origin xyz="${base_2_HFE_x} ${base_2_HFE_y} 0" rpy="0 0 0" />
        </xacro:unless>
        <xacro:if value="${is_right}">
          <origin xyz="${base_2_HFE_x} ${-base_2_HFE_y} 0" rpy="0 0 0" />
        </xacro:if>
      </xacro:if>
      <xacro:unless value="${is_front}">
        <xacro:unless value="${is_right}">
          <origin xyz="${-base_2_HFE_x} ${base_2_HFE_y} 0" rpy="0 0 0" />
        </xacro:unless>
        <xacro:if value="${is_right}">
          <origin xyz="${-base_2_HFE_x} ${-base_2_HFE_y} 0" rpy="0 0 0" />
        </xacro:if>
      </xacro:unless>
      <!-- pybullet simulation parameters -->
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}_UPPER_LEG">
      <!-- UPPER LEG LINK INERTIAL -->
      <inertial>
        <origin rpy="0 0 0" xyz="0 0 -0.0793"/>
        <mass value="${upper_leg_mass}"/>
        <inertia ixy="0.0" ixz="0.0" iyz="0.0"
          ixx="0.000469609"
          iyy="0.000469609"
          izz="1e-6"/>
      </inertial>
      <!-- UPPER LEG LINK VISUAL -->
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <xacro:unless value="${is_right}">
            <mesh filename="package://robot_properties_quadruped/meshes/${mesh_ext}/stl_with_foot/quadruped_upper_leg_left_side.${mesh_ext}"/>
          </xacro:unless>
          <xacro:if value="${is_right}">
            <mesh filename="package://robot_properties_quadruped/meshes/${mesh_ext}/stl_with_foot/quadruped_upper_leg_right_side.${mesh_ext}"/>
          </xacro:if>
        </geometry>
        <material name="${color_name}">
            <color rgba="${color} ${opacity}"/>
        </material>
      </visual>
      <!-- UPPER LEG LINK COLLISION -->
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <xacro:unless value="${is_right}">
            <mesh filename="package://robot_properties_quadruped/meshes/${mesh_ext}/stl_with_foot/quadruped_upper_leg_left_side.${mesh_ext}"/>
          </xacro:unless>
          <xacro:if value="${is_right}">
            <mesh filename="package://robot_properties_quadruped/meshes/${mesh_ext}/stl_with_foot/quadruped_upper_leg_right_side.${mesh_ext}"/>
          </xacro:if>
        </geometry>
        <material name="${color_name}">
            <color rgba="${color} ${opacity}"/>
        </material>
      </collision>
    </link> <!-- END UPPER LEG LINK -->

    <!-- KFE: Joint between the upper leg and the lower leg -->
    <joint name="${prefix}_KFE" type="revolute">
      <parent link="${prefix}_UPPER_LEG"/>
      <child link="${prefix}_LOWER_LEG"/>
      <limit effort="1000" lower="-10" upper="10" velocity="1000"/>
      <!-- joints rotates around the y-axis -->
      <axis xyz="0 1 0"/>
      <!-- placement of the joint -->
      <xacro:if value="${is_front}">
        <xacro:unless value="${is_right}">
          <origin xyz="0 ${HFE_2_KFE_y} ${-HFE_2_KFE_z}" rpy="0 0 0" />
        </xacro:unless>
        <xacro:if value="${is_right}">
          <origin xyz="0 ${-HFE_2_KFE_y} ${-HFE_2_KFE_z}" rpy="0 0 0" />
        </xacro:if>
      </xacro:if>
      <xacro:unless value="${is_front}">
        <xacro:unless value="${is_right}">
          <origin xyz="0 ${HFE_2_KFE_y} ${-HFE_2_KFE_z}" rpy="0 0 0" />
        </xacro:unless>
        <xacro:if value="${is_right}">
          <origin xyz="0 ${-HFE_2_KFE_y} ${-HFE_2_KFE_z}" rpy="0 0 0" />
        </xacro:if>
      </xacro:unless>
      <!-- pybullet simulation parameters -->
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}_LOWER_LEG">
      <!-- LOWER LEG LINK INERTIAL -->
      <inertial>
        <origin rpy="0 0 0" xyz="0 0 -0.0756"/>
        <mass value="${lower_leg_mass + 0.01}"/>
        <inertia ixy="0.0" ixz="0.0" iyz="0.0"
          ixx="0.000087575"
          iyy="0.000087575"
          izz="1e-6"/>
     </inertial>
      <!-- LOWER LEG LINK VISUAL -->
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <xacro:unless value="${is_right}">
            <mesh filename="package://robot_properties_quadruped/meshes/${mesh_ext}/stl_with_foot/quadruped_lower_leg_left_side.${mesh_ext}"/>
          </xacro:unless>
          <xacro:if value="${is_right}">
            <mesh filename="package://robot_properties_quadruped/meshes/${mesh_ext}/stl_with_foot/quadruped_lower_leg_right_side.${mesh_ext}"/>
          </xacro:if>
        </geometry>
        <material name="${color_name}">
            <color rgba="${color} ${opacity}"/>
        </material>
      </visual>
      <!-- LOWER LEG LINK COLLISION -->
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <xacro:unless value="${is_right}">
            <mesh filename="package://robot_properties_quadruped/meshes/${mesh_ext}/stl_with_foot/quadruped_lower_leg_left_side.${mesh_ext}"/>
          </xacro:unless>
          <xacro:if value="${is_right}">
            <mesh filename="package://robot_properties_quadruped/meshes/${mesh_ext}/stl_with_foot/quadruped_lower_leg_right_side.${mesh_ext}"/>
          </xacro:if>
        </geometry>
        <material name="${color_name}">
            <color rgba="${color} ${opacity}"/>
        </material>
      </collision>
    </link> <!-- END LOWER LEG LINK -->

    <!-- KFE: Joint between the upper leg and the lower leg -->
    <joint name="${prefix}_ANKLE" type="fixed">
      <parent link="${prefix}_LOWER_LEG"/>
      <child link="${prefix}_FOOT"/>
      <!-- Joint placement -->
      <origin xyz="0 0 ${-HFE_2_KFE_z}" rpy="0 0 0" />
      <!-- Limits (usefull?) -->
      <limit effort="1000" lower="-10" upper="10" velocity="1000"/>
      <!-- pybullet simulation parameters -->
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}_FOOT">
    </link>

  </xacro:macro>
</robot>